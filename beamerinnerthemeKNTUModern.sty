
% Theme for KNTU - K.N toosi University of Technology
%
% Implemented by: 
% Emad Pourhassani

\RequirePackage{calc}
\RequirePackage{eso-pic}
\RequirePackage{thmtools}

%% Options for theoremstyles
\DeclareOptionBeamer{unnumbered}{ \def \OMtheorem {}          }
\DeclareOptionBeamer{numbered}  { \def \OMtheorem {numbered}  }
\DeclareOptionBeamer{AMS}       { \def \OMtheorem {ams style} }

%% Declaring Language, so image is correctly made.
\DeclareOptionBeamer{eng}
{
    \def \KNTUlang {eng}
    \def \KNTUphoto {Photo}
}

\DeclareOptionBeamer{TitlePage} { \def \KNTUfirstframe {\TitlePage}  }
\DeclareOptionBeamer{NoTitlePage} { \def \KNTUfirstframe {} }

\ExecuteOptionsBeamer{eng, unnumbered, TitlePage}
\ProcessOptionsBeamer

\AtBeginDocument{ \KNTUfirstframe }

\mode<presentation>

\setbeamertemplate{theorems}[\KNTUtheorem]
\setbeamertemplate{qed symbol}{{\(\blacksquare\)}}
\setbeamertemplate{caption label separator}{: }

\useinnertheme{rectangles}

%%% The front page 

\setbeamertemplate{title page}
{
    \AddToShipoutPictureFG*
    {
        \AtPageLowerLeft
        {
            \hspace{11.2cm}
            \transparent{0.4}\includegraphics[scale=1.2]{images/KNTU-white.png}
        }
    }

    \vspace{2cm}
    \hspace*{0pt}
    \begin{minipage}[b][\paperheight - 3cm]{\paperwidth - 5.3cm}
        \raggedright

        \vspace{\stretch{0.5}}

        \usebeamerfont{title}
        \inserttitle
        \\[0.2ex]
        \usebeamerfont{subtitle}
        \insertsubtitle

        \vspace{\stretch{1}}

        \usebeamerfont{author}
        \insertauthor

        \vspace{0.135\paperheight}
    \end{minipage}
}

\newcommand{\TitlePage}
{{
    \setbeamercolor{background canvas}{parent = title page}
    \begin{frame}[b, plain, noframenumbering]
        \titlepage
    \end{frame}
}}

%%%% Section Page

\setbeamertemplate{section page}
{
    \begin{center}
        \vskip\baselineskip
        \insertsection
    \end{center}
}

\newcommand{\SectionPage}
{{
    \setbeamercolor{background canvas}{parent = section page}
    \begin{frame}[c, plain, noframenumbering]
        \sectionpage
    \end{frame}
}}

%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%% Blocks %%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%

%% Redefine blocks with larger indentations,
%% and some environmental colours:
\setbeamertemplate{block begin}
{
    \setbeamercolor{local structure}{use = block title, fg = block title.bg}
    \setbeamercolor{item projected}{use = block title,
                                    fg = block title.fg,
                                    bg = block title.bg}

    \unskip
    \vskip1.3ex

    \begin{beamercolorbox}[ht        = 2.4  ex,
                           dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex]
                          {block title}
        \usebeamerfont*{block title}
        \insertblocktitle
    \end{beamercolorbox}

    \nointerlineskip

    \usebeamerfont{block body}
    \begin{beamercolorbox}[dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex,
                           vmode]
                          {block body}
        \vspace*{1ex}
        \begin{minipage}{\textwidth - 1.5ex}
}

\setbeamertemplate{block end}
{
    \end{minipage}
    \vskip0pt
    \end{beamercolorbox}
    \vskip1.3ex
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{block example begin}
{
    \setbeamercolor{local structure}{use = block title example, 
                                     fg = block title example.bg}
    \setbeamercolor{item projected}{use = block title example,
                                    fg = block title example.fg,
                                    bg = block title example.bg}

    \unskip
    \vskip1.3ex

    \begin{beamercolorbox}[ht        = 2.4  ex,
                           dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex]
                          {block title example}

        \usebeamerfont*{block title example}
        \insertblocktitle
    \end{beamercolorbox}

    \nointerlineskip

    \usebeamerfont{block body example}
    \begin{beamercolorbox}[dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex,
                           vmode]
                          {block body example}
        \vspace*{1ex}
        \begin{minipage}{\textwidth - 1.5ex}
}

\setbeamertemplate{block example end}
{
        \end{minipage}
    \vskip0pt
    \end{beamercolorbox}
    \vskip1.3ex
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\setbeamertemplate{block alerted begin}
{
    \setbeamercolor{local structure}{use = block title alerted
                                     fg = block title alerted.bg}
    \setbeamercolor{item projected}{use = block title alerted,
                                    fg = block title alerted.fg,
                                    bg = block title alerted.bg}
    \setbeamercolor{description item}{use = alerted text, fg = alerted text.fg}
    \setbeamercolor{caption name}    {use = alerted text, fg = alerted text.fg}

    \unskip
    \vskip1.3ex

    \begin{beamercolorbox}[ht        = 2.4  ex,
                           dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex]
                          {block title alerted}

        \usebeamerfont*{block title alerted}
        \insertblocktitle
    \end{beamercolorbox}

    \nointerlineskip

    \usebeamerfont{block body alerted}
    \begin{beamercolorbox}[dp        = 1    ex,
                           leftskip  = 0.75 ex,
                           rightskip = 0.75 ex,
                           vmode]
                          {block body alerted}
        \vspace*{1ex}
        \begin{minipage}{\textwidth - 1.5ex}
}

\setbeamertemplate{block alerted end}
{
        \end{minipage}
    \vskip0pt
    \end{beamercolorbox}
    \vskip1.3ex
}

\mode<all>
